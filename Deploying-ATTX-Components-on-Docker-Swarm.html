
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Deploying ATTX Components on Docker Swarm Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.html" />
    
    
    <link rel="prev" href="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">ATTX Project</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Architecture.html">
            
                <a href="Architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Platform-Deployment.html">
            
                <a href="Platform-Deployment.html">
            
                    
                    Platform Deployment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="CSC-cPouta-Cloud-Services-Report.html">
            
                <a href="CSC-cPouta-Cloud-Services-Report.html">
            
                    
                    CSC cPouta Cloud Services Report
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Building-Docker-application-stacks-in-Swarm-Mode.html">
            
                <a href="Building-Docker-application-stacks-in-Swarm-Mode.html">
            
                    
                    Building Swarm Mode on a PC or Mac
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html">
            
                <a href="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html">
            
                    
                    Provisioning ATTX Components on CSC Open Stack (cPouta)
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.4" data-path="Deploying-ATTX-Components-on-Docker-Swarm.html">
            
                <a href="Deploying-ATTX-Components-on-Docker-Swarm.html">
            
                    
                    Deploying ATTX Components on Docker Swarm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.html">
            
                <a href="Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.html">
            
                    
                    Running the ATTX Stack on a PC or Mac
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="Using-Consul-for-Service-Discovery-on-Docker-Swarm.html">
            
                <a href="Using-Consul-for-Service-Discovery-on-Docker-Swarm.html">
            
                    
                    Using Consul for Service Discovery on Docker Swarm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Workflow-Component.html">
            
                <a href="Workflow-Component.html">
            
                    
                    Workflow Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="ETL-Artifacts.html">
            
                <a href="ETL-Artifacts.html">
            
                    
                    ETL Artifacts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="Unified-Views-plugins.html">
            
                <a href="Unified-Views-plugins.html">
            
                    
                    UnifiedViews plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="WF-API.html">
            
                <a href="WF-API.html">
            
                    
                    Workflow API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Graph-Component.html">
            
                <a href="Graph-Component.html">
            
                    
                    Graph Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="Graph-Manager-API.html">
            
                <a href="Graph-Manager-API.html">
            
                    
                    Graph Manager API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="Graph-Store.html">
            
                <a href="Graph-Store.html">
            
                    
                    Graph Store
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="Data-Model.html">
            
                <a href="Data-Model.html">
            
                    
                    Ontology/Data model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="Namespaces.html">
            
                <a href="Namespaces.html">
            
                    
                    Graph Namespaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="Linking-Strategies.html">
            
                <a href="Linking-Strategies.html">
            
                    
                    Linking Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Distribution-Component.html">
            
                <a href="Distribution-Component.html">
            
                    
                    Distribution Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="ElasticSearch-with-Siren.html">
            
                <a href="ElasticSearch-with-Siren.html">
            
                    
                    ElasticSearch with Siren
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="ElasticSearch-5.html">
            
                <a href="ElasticSearch-5.html">
            
                    
                    ElasticSearch 5.x
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="Applications-and-Use-Cases.html">
            
                <a href="Applications-and-Use-Cases.html">
            
                    
                    Applications and Use Cases
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="UC1---Infrastructures-and-publications.html">
            
                <a href="UC1---Infrastructures-and-publications.html">
            
                    
                    UC1 - infras and pubs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="Use-case-Metax.html">
            
                <a href="Use-case-Metax.html">
            
                    
                    UC - Metax
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Project Guidelines</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="Feature-roadmap.html">
            
                <a href="Feature-roadmap.html">
            
                    
                    Feature Roadmap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Release-Plan.html">
            
                <a href="Release-Plan.html">
            
                    
                    Release Plan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="Project-Development-Environment.html">
            
                <a href="Project-Development-Environment.html">
            
                    
                    Project Development Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="CI-CD-Enviroment.html">
            
                <a href="CI-CD-Enviroment.html">
            
                    
                    CI/CD Enviroment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="Jenkins.html">
            
                <a href="Jenkins.html">
            
                    
                    Jenkins CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="Build-Multiple-Environments.html">
            
                <a href="Build-Multiple-Environments.html">
            
                    
                    Build Environment Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.3" data-path="Containerized-testing.html">
            
                <a href="Containerized-testing.html">
            
                    
                    Containerized testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
                <span>
            
                    
                    Reports
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="Building-with-Gradle.html">
            
                <a href="Building-with-Gradle.html">
            
                    
                    Building with (Py)Gradle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.2" data-path="Messaging-Brokers.html">
            
                <a href="Messaging-Brokers.html">
            
                    
                    Messaging Brokers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.3" data-path="Service-Discovery.html">
            
                <a href="Service-Discovery.html">
            
                    
                    Service Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.4" data-path="Workflow-Management-Tools.html">
            
                <a href="Workflow-Management-Tools.html">
            
                    
                    Workflow Management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="Contributions.html">
            
                <a href="Contributions.html">
            
                    
                    Contributions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.6.1" data-path="ELAG-2017.html">
            
                <a href="ELAG-2017.html">
            
                    
                    ELAG2017
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://www.helsinki.fi/en/projects/attx-2016">
            
                    
                    ATTX website
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Deploying ATTX Components on Docker Swarm</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="deploying-attx-components-on-docker-swarm">Deploying ATTX Components on Docker Swarm</h1>
<p>This guide exemplifies how to deploy the ATTX components on Docker Swarm, by setting up OpenStack volumes for  data persistence and using a v3 Docker Composer YML definition file.</p>
<!-- TOC START min:1 max:3 link:true update:false -->
<ul>
<li><a href="#setting-up-openstack-volumes-for-data-persistence">Setting up OpenStack volumes for data persistence</a></li>
<li><a href="#deploying-the-attx-components">Deploying the ATTX components</a><!-- TOC END -->
</li>
</ul>
<p>Given that the ATTX components are containerised, we need to ensure data persistence between container restarts. In practice, ATTX components will need access to file systems in data volumes in order to write and read data.</p>
<p>The ATTX Docker Compose v3 YML file defines the mappings between the internal containers and file systems, and the following list states the containers that need data persistence, as well as the mappings between internal and file system data storage:</p>
<ul>
<li>UnifiedViews DB (MySQL): <code>/uv-data/mysql:/var/lib/mysql</code>;</li>
<li>ElasticSearch 2.2 (with Siren plugin): <code>/attx-data/essiren:/usr/share/elasticsearch/data</code>;</li>
<li>Elasticsearch 5.2: <code>/attx-data/elasticsearch5:/usr/share/elasticsearch/data</code>;</li>
<li>Fuseki: <code>/attx-data/fuseki:/data/fuseki</code>;</li>
<li>GM-API: <code>/attx-data/gm-api:/app/data</code>.</li>
</ul>
<p>In short, the procedure will consist in first setting up OpenStack volumes for data persistency, and secondly in deploying the ATTX components defined in v3 Docker Composer YML with Docker Swarm commands.</p>
<p><strong>Pre-requisite:</strong> Docker Swarm formed on Cpouta and essential components provisioned (cf. <a href="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html">Provisioning ATTX Components on CSC Open Stack (cPouta)</a>).</p>
<h2 id="setting-up-openstack-volumes-for-data-persistence">Setting up OpenStack volumes for data persistence</h2>
<p><strong>1.</strong> Create a persistent storage volume for UnifiedViews (e.g. &apos;uv-data&apos;) and attach it to the Swarm Master, as per instructions in <a href="https://research.csc.fi/pouta-persistent-volumes" target="_blank">https://research.csc.fi/pouta-persistent-volumes</a>.</p>
<p><strong>2.</strong> Create a persistent storage volume for ATTX components (e.g. &apos;attx-data&apos;) and attach it to the first Swarm worker, as per instructions in <a href="https://research.csc.fi/pouta-persistent-volumes" target="_blank">https://research.csc.fi/pouta-persistent-volumes</a>.</p>
<p><strong>3.</strong> Next, you should partition the new volumes, label them, create new file systems on them, and mount them. If you wish, you can follow the above-mentioned CSC instructions as they are, but for consistency with  existing ATTX practices we do recommend you to tag the partitions as &quot;uv-data&quot; and &quot;attx-data&quot; and mount them in &quot;/uv-data&quot; and &quot;/attx-data&quot; respectively:</p>
<p><strong>3.1</strong>
Create a label (&quot;uv-data&quot;) for the partition that will be use to store UnifiedViews data:</p>
<pre><code>sudo e2label /dev/vdc1 uv-data
</code></pre><p>Create a &quot;/uv-data&quot; mount point and mount the volume:</p>
<pre><code>sudo mkdir /uv-data
sudo mount /dev/vdc1 /uv-data
</code></pre><p>And taking the &quot;data&quot; label and &quot;/data&quot; change into account in /etc/fstab:</p>
<pre><code>sudo echo &quot;LABEL=uv-data    /uv-data    ext4    defaults    0    0&quot; &gt;&gt; /etc/fstab
</code></pre><p>Now you can create the directories that will be used by the UnifiedViews containers who need data persistence (unified-views-mariadb)</p>
<pre><code>sudo mkdir /uv-data/mariadb
</code></pre><p><strong>3.2.</strong>
Create a label (&quot;attx-data&quot;) for the partition that will be use to store ATTX data:</p>
<pre><code>sudo e2label /dev/vdc1 attx-data
</code></pre><p>Create a &quot;/attx-data&quot; mount point and mount the volume:</p>
<pre><code>sudo mkdir /attx-data
sudo mount /dev/vdc1 /attx-data
</code></pre><p>And taking the &quot;attx-data&quot; label and &quot;/attx-data&quot; change into account in /etc/fstab:</p>
<pre><code>sudo echo &quot;LABEL=attx-data    /attx-data    ext4    defaults    0    0&quot; &gt;&gt; /etc/fstab
</code></pre><p>Now you can create the directories that will be used by the ATTX containers who need data persistence (UnifiedViews DB, Fuseki, ElasticSearch 2.2, ElasticSearch 5.2)</p>
<pre><code>sudo mkdir /attx-data/essiren
sudo mkdir /attx-data/elasticsearch5
sudo mkdir /attx-data/fuseki
sudo mkdir /attx-data/gmapi
</code></pre><h2 id="deploying-the-attx-components">Deploying the ATTX components</h2>
<p><strong>1.</strong>
With the data volumes in place (as well as the Provisioning, cf. <a href="https://github.com/ATTX-project/project-management/wiki/Provisioning-ATTX-Components-on-CSC-Open-Stack-(cPouta" target="_blank">https://github.com/ATTX-project/project-management/wiki/Provisioning-ATTX-Components-on-CSC-Open-Stack-(cPouta</a>)), it&apos;s now time deploy the ATTX application stack in Docker Swarm.</p>
<p>Download the latest ATTX Docker Swarm YML stack (e.g. <a href="https://github.com/ATTX-project/platform-deployment/blob/dev/swarm-mode-cpouta/attx-swarm.yml" target="_blank">https://github.com/ATTX-project/platform-deployment/blob/dev/swarm-mode-cpouta/attx-swarm.yml</a>) to your Swarm Master node (e.g. attx-swarm-1), to <code>/home/cloud-user/swarm-mode-cpouta</code>, for example.</p>
<p>To deploy the ATTX application stack in Docker Swarm from <code>/home/cloud-user/swarm-mode-cpouta</code>, run:</p>
<pre><code>$ docker stack deploy --compose-file attx-swarm.yml attx
</code></pre><p>Verify that all services are starting up:</p>
<pre><code>$ docker service ls
</code></pre><p>The output should be similar as follows (mind that the <code>uv-dpus</code> and <code>attx-shared</code> should run once and then exit):</p>
<pre><code>cloud-user@attx-swarm-1:~/swarm-mode-cpouta$ docker service ls
ID            NAME                 MODE        REPLICAS  IMAGE
2ghu5r2ig9ii  attx_essiren         replicated  1/1       attxtest/essiren:latest
57b62rzt0dlw  attx_backend         replicated  1/1       tenforce/unified-views-backend:latest
j8bbprqi695s  attx_wfapi           replicated  1/1       attxtest/wf-api:latest
lttan3dficf0  attx_mysql           replicated  1/1       tenforce/unified-views-mariadb:feat-compact-modular
n37grvnuclbt  attx_uv-dpus         replicated  0/1       tenforce/unified-views-add-dpus:latest
nc4x8h88h84y  attx_attx-dpus       replicated  1/1       attxtest/uv-attx-dpus:latest
ozwzjngvavwn  attx_frontend        replicated  1/1       tenforce/unified-views-frontend:latest
te3o51dqwtmg  attx_shared          replicated  0/1       attxtest/uv-attx-shared:latest
v2e06blmfzan  attx_elasticsearch5  replicated  1/1       attxtest/attx-es5:latest
vmvjvz2swvp1  attx_fuseki          replicated  1/1       attxtest/attx-fuseki:latest
wyi8p9zl770c  attx_gmapi           replicated  1/1       attxtest/gm-api:latest
</code></pre><p><strong>2.</strong>
Once the ATTX services are running, you can also check whether UnifiedViews is operational. The UnifiedViews login page should be available at <code>http://&lt;Swarm_public_IP_address&gt;:8080/unifiedviews</code> and you should able to login.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html" class="navigation navigation-prev " aria-label="Previous page: Provisioning ATTX Components on CSC Open Stack (cPouta)">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.html" class="navigation navigation-next " aria-label="Next page: Running the ATTX Stack on a PC or Mac">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Deploying ATTX Components on Docker Swarm","level":"1.3.4","depth":2,"next":{"title":"Running the ATTX Stack on a PC or Mac","level":"1.3.5","depth":2,"path":"Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.md","ref":"Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.md","articles":[]},"previous":{"title":"Provisioning ATTX Components on CSC Open Stack (cPouta)","level":"1.3.3","depth":2,"path":"Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.md","ref":"Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["highlight"],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Deploying-ATTX-Components-on-Docker-Swarm.md","mtime":"2017-05-04T09:15:00.999Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-05-04T09:24:07.936Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

