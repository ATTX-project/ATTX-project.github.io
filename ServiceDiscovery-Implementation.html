
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Service Discovery Implementation Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-git-author/style.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Consul-for-Service-Discovery-on-Docker-Swarm.html" />
    
    
    <link rel="prev" href="ElasticSearch-5.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">ATTX Project</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Applications and Use Cases
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="Use-case-Infrastructures-and-publications.html">
            
                <a href="Use-case-Infrastructures-and-publications.html">
            
                    
                    UC1 - Infrastructure and Publications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="Use-case-Jyvaskyla.html">
            
                <a href="Use-case-Jyvaskyla.html">
            
                    
                    UC2 - Parallel Publication Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="Use-case-Metax.html">
            
                <a href="Use-case-Metax.html">
            
                    
                    UC3 - Metax
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="ATTX-Architecture-Overview.html">
            
                <a href="ATTX-Architecture-Overview.html">
            
                    
                    ATTX Architecture Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="ATTX-Broker-Deployment.html">
            
                <a href="ATTX-Broker-Deployment.html">
            
                    
                    ATTX Broker Deployment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                    Run on Single Machine PC/Mac/VM
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="Building-Docker-application-stacks-in-Swarm-Mode.html">
            
                <a href="Building-Docker-application-stacks-in-Swarm-Mode.html">
            
                    
                    Building Swarm Mode on a PC/Mac
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.html">
            
                <a href="Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.html">
            
                    
                    Running the ATTX Stack on a PC/Mac
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" >
            
                <span>
            
                    
                    Run on Distributed/Cloud
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html">
            
                <a href="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html">
            
                    
                    Provisioning ATTX Components on CSC Open Stack (cPouta)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="Deploying-ATTX-Components-on-Docker-Swarm.html">
            
                <a href="Deploying-ATTX-Components-on-Docker-Swarm.html">
            
                    
                    Deploying ATTX Components on Docker Swarm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="Applying-Rolling-Updates-to-services-in-Docker-Swarm.html">
            
                <a href="Applying-Rolling-Updates-to-services-in-Docker-Swarm.html">
            
                    
                    Applying Rolling Updates to Services in Docker Swarm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Workflow-Component.html">
            
                <a href="Workflow-Component.html">
            
                    
                    Workflow Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="ETL-Artifacts.html">
            
                <a href="ETL-Artifacts.html">
            
                    
                    ETL Artifacts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="Unified-Views-plugins.html">
            
                <a href="Unified-Views-plugins.html">
            
                    
                    UnifiedViews Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="Workflow-API.html">
            
                <a href="Workflow-API.html">
            
                    
                    Workflow API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Graph-Component.html">
            
                <a href="Graph-Component.html">
            
                    
                    Graph Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="Graph-Manager-API.html">
            
                <a href="Graph-Manager-API.html">
            
                    
                    Graph Manager API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="Graph-Store.html">
            
                <a href="Graph-Store.html">
            
                    
                    Graph Store
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="Data-Model.html">
            
                <a href="Data-Model.html">
            
                    
                    Ontology/Data model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="Namespaces.html">
            
                <a href="Namespaces.html">
            
                    
                    Graph Namespaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="Linking-Strategies.html">
            
                <a href="Linking-Strategies.html">
            
                    
                    Linking Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="Distribution-Component.html">
            
                <a href="Distribution-Component.html">
            
                    
                    Distribution Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="ElasticSearch-with-Siren.html">
            
                <a href="ElasticSearch-with-Siren.html">
            
                    
                    ElasticSearch with Siren
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="ElasticSearch-5.html">
            
                <a href="ElasticSearch-5.html">
            
                    
                    ElasticSearch 5.x
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.8" data-path="ServiceDiscovery-Implementation.html">
            
                <a href="ServiceDiscovery-Implementation.html">
            
                    
                    Service Discovery Implementation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="Consul-for-Service-Discovery-on-Docker-Swarm.html">
            
                <a href="Consul-for-Service-Discovery-on-Docker-Swarm.html">
            
                    
                    Consul for Service Discovery on Docker Swarm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">User Guide</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="User-Guide-Administrator.html">
            
                <a href="User-Guide-Administrator.html">
            
                    
                    Data Administrator's User guide
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Project Guidelines</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="Feature-roadmap.html">
            
                <a href="Feature-roadmap.html">
            
                    
                    Feature Roadmap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="Release-Plan.html">
            
                <a href="Release-Plan.html">
            
                    
                    Release Plan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="Project-Development-Environment.html">
            
                <a href="Project-Development-Environment.html">
            
                    
                    Project Development Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="CI-CD-Enviroment.html">
            
                <a href="CI-CD-Enviroment.html">
            
                    
                    CI/CD Enviroment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="Jenkins-CI.html">
            
                <a href="Jenkins-CI.html">
            
                    
                    Jenkins CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="Build-Environment-Setup.html">
            
                <a href="Build-Environment-Setup.html">
            
                    
                    Build Environment Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.3" data-path="Containerized-testing.html">
            
                <a href="Containerized-testing.html">
            
                    
                    Containerized Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Project Contributions</li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    Reports
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="Deploying-ATTX-SB-on-Kontena.html">
            
                <a href="Deploying-ATTX-SB-on-Kontena.html">
            
                    
                    Deploying the ATTX Semantic Broker on Kontena
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="CSC-cPouta-Cloud-Services-Report.html">
            
                <a href="CSC-cPouta-Cloud-Services-Report.html">
            
                    
                    CSC cPouta Cloud Services Report
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="Building-with-Gradle.html">
            
                <a href="Building-with-Gradle.html">
            
                    
                    Building with (Py)Gradle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="Messaging-Brokers-Solutions.html">
            
                <a href="Messaging-Brokers-Solutions.html">
            
                    
                    Messaging Brokers Solutions Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="Service-Discovery-Solutions.html">
            
                <a href="Service-Discovery-Solutions.html">
            
                    
                    Service Discovery Solutions Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="Workflow-Management-Tools.html">
            
                <a href="Workflow-Management-Tools.html">
            
                    
                    Workflow Management Tools Overview
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" >
            
                <span>
            
                    
                    Presentations
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="ELAG-2017.html">
            
                <a href="ELAG-2017.html">
            
                    
                    ELAG2017
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="SWIB-2017.html">
            
                <a href="SWIB-2017.html">
            
                    
                    SWIB2017
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="Open-Contributions.html">
            
                <a href="Open-Contributions.html">
            
                    
                    Open Source Contributions
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <a target="_blank" href="https://www.helsinki.fi/en/projects/attx-2016">
            
                    
                    ATTX website
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Service Discovery Implementation</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div class="git-author-container git-author-top"><div class="modified">Current page last modified at: 29-May-2017 08:05:43</div></div><h1 id="service-discovery-implementation">Service Discovery Implementation</h1>
<!-- TOC START min:1 max:4 link:true update:false -->
<ul>
<li><a href="#consul-in-practice">Consul in Practice</a><ul>
<li><a href="#registering-a-service">Registering a Service</a></li>
<li><a href="#making-use-of-registered-services">Making Use of Registered Services</a><ul>
<li><a href="#using-consul-tags">Using Consul Tags</a></li>
</ul>
</li>
<li><a href="#storing-keyvalue-pairs-in-consul">Storing Key/Value pairs in Consul</a></li>
<li><a href="#consul-and-docker-swarm">Consul and Docker SWARM</a><ul>
<li><a href="#using-consul-catalog-for-service-discovery">Using Consul Catalog for Service Discovery</a></li>
<li><a href="#using-consul-kv-for-service-discovery">Using Consul K/V for Service Discovery</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
<!-- TOC END -->
<h2 id="consul-in-practice">Consul in Practice</h2>
<p>Service Discovery is part of the ATTX Semantic Broker main components as it addresses the need to deal with with static and manual configuration of components and at the same time the need to scale up the (micro)services offered by the broker.</p>
<p>In order to understand what components, when they communicate and what/how they communicate to each other using Service Discover component, we envision the following:</p>
<ul>
<li>(micro)services offered by the Graph, Workflow and Distribution components require to register services such as Graph-Manager-API, Workflow-API, ElasticSearch or any other of processing components - see <a href="User-Guide-Administrator.html">Administrator&apos;s User Guide</a>;</li>
<li>configurations specific to the Graph Store (e.g. Fuseki endpoint(s)) or the MariaDB configuration for Workflow-API or several (micro)services parameters will be stored in the Consul KV store;</li>
<li>Accessing the registered (micro)services can be achieved either directly from the Consul DNS/HTTP API or via the proxy/router (for additional load balancing), meanwhile accessing the KV store should be done directly from Consul HTTP API - these solutions fit into the Service Discovery patterns:<ul>
<li>Client-Side Service Discovery: <a href="http://microservices.io/patterns/client-side-discovery.html" target="_blank">http://microservices.io/patterns/client-side-discovery.html</a></li>
<li>Server-Side Service Discovery: <a href="http://microservices.io/patterns/server-side-discovery.html" target="_blank">http://microservices.io/patterns/server-side-discovery.html</a></li>
</ul>
</li>
</ul>
<h3 id="registering-a-service">Registering a Service</h3>
<p>Registering a service can be achieved using one of the recommended libraries <a href="https://www.consul.io/api/libraries-and-sdks.html" target="_blank">https://www.consul.io/api/libraries-and-sdks.html</a> e.g. using python-consul</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> consul

c = consul.Consul(host=<span class="hljs-string">&apos;attx-sandbox&apos;</span>, port=<span class="hljs-number">8500</span>)
<span class="hljs-comment"># Register Service</span>
c.agent.service.register(<span class="hljs-string">&apos;restapi&apos;</span>,
                         service_id=<span class="hljs-string">&apos;restapi_1&apos;</span>,
                         port=<span class="hljs-number">4300</span>,
                         tags=[<span class="hljs-string">&apos;graph-component&apos;</span>])
</code></pre>
<p>One of the main questions is when to de-register a service, however a more appropriate issue would be to do a healthcheck (<code>/health</code> endpoint already available for GM and WF APIs), also considering some of the services run under supervisor, and will try be restarted, the function of de-registering should be part of shutting down a service.</p>
<h3 id="making-use-of-registered-services">Making Use of Registered Services</h3>
<p>An overview how we might make use of such services is as described in the diagram below, however two cases can bet identified:</p>
<ol>
<li>accessing a service remote API such as HTTP/REST  at a particular location (host and port) via an client (e.g. browser, DPU);</li>
<li>having different services talking to one another.</li>
</ol>
<p>While in both cases the Server-Side Service Discovery pattern could be used, it seems more feasible, to have the services talking to one another by querying the Service Registry/Discovery service directly or using Docker Flow Proxy (just for registering, TBD if they can talk to one another via Docker Flow Proxy) - see <a href="Consul-for-Service-Discovery-on-Docker-Swarm.html">Consul for Service Discovery on Docker Swarm</a> for more details.</p>
<pre><code>Client          Proxy/Router         Service Registry/Discovery      Service A

                                                 1.register Service A

                                              &lt;--------------------------+
  2. Client request

+--------------------&gt;

                    3. Proxy Asks for Service A

                +--------------------------------&gt;
                ^--------------------------------+

                          4. Proxy Forwards request to Service A

                    +-------------------------------------------------------&gt;

             5. Service A responds to the request to Client (via Proxy)

    &lt;----------------------------------------------------------------------+
</code></pre><h4 id="using-consul-tags">Using Consul Tags</h4>
<p>Tags could be used to distinguish between either special instances of a service, e.g. &quot;Reasoning with OWL-DL&quot; and &quot;Reasoning with RDFS+&quot; - same service but with different reasoners configure behind.</p>
<pre><code class="lang-json">[{
    <span class="hljs-string">&quot;Node&quot;</span>: <span class="hljs-string">&quot;app-registry-discovery-node1&quot;</span>,
    <span class="hljs-string">&quot;Address&quot;</span>: <span class="hljs-string">&quot;x.x.x.x&quot;</span>,
    <span class="hljs-string">&quot;ServiceID&quot;</span>: <span class="hljs-string">&quot;api-server-8000&quot;</span>,
    <span class="hljs-string">&quot;ServiceName&quot;</span>: <span class="hljs-string">&quot;api-server&quot;</span>,
    <span class="hljs-string">&quot;ServiceTags&quot;</span>: [<span class="hljs-string">&quot;dev&quot;</span>, <span class="hljs-string">&quot;provider-abc&quot;</span>],
    <span class="hljs-string">&quot;ServiceAddress&quot;</span>: <span class="hljs-string">&quot;someserver.domain.com&quot;</span>,
    <span class="hljs-string">&quot;ServicePort&quot;</span>: <span class="hljs-number">8000</span>
}, {
    <span class="hljs-string">&quot;Node&quot;</span>: <span class="hljs-string">&quot;app-registry-discovery-node1&quot;</span>,
    <span class="hljs-string">&quot;Address&quot;</span>: <span class="hljs-string">&quot;x.x.x.x&quot;</span>,
    <span class="hljs-string">&quot;ServiceID&quot;</span>: <span class="hljs-string">&quot;api-server-8001&quot;</span>,
    <span class="hljs-string">&quot;ServiceName&quot;</span>: <span class="hljs-string">&quot;api-server&quot;</span>,
    <span class="hljs-string">&quot;ServiceTags&quot;</span>: [<span class="hljs-string">&quot;dev&quot;</span>, <span class="hljs-string">&quot;provider-xyz&quot;</span>],
    <span class="hljs-string">&quot;ServiceAddress&quot;</span>: <span class="hljs-string">&quot;someserver.domain.com&quot;</span>,
    <span class="hljs-string">&quot;ServicePort&quot;</span>: <span class="hljs-number">8001</span>
}]
</code></pre>
<p>Accessing services with specific tags would work such as:
<code>http://consul-server/v1/catalog/service/api-server?tag=dev</code></p>
<h3 id="storing-keyvalue-pairs-in-consul">Storing Key/Value pairs in Consul</h3>
<p>Because the Consul provides something that resembles more of a dictionary than a document store, trying to register something like:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;first_level&quot;</span> : {
    <span class="hljs-string">&quot;second_level&quot;</span> : {
      <span class="hljs-string">&quot;third_level&quot;</span> : {
        <span class="hljs-string">&quot;theKey&quot;</span> : <span class="hljs-string">&quot;theValue&quot;</span>
      }
    }
  }
}
</code></pre>
<p>One would have several options (as pointed by: <a href="https://groups.google.com/forum/#!topic/consul-tool/DgwWdpntaAY" target="_blank">https://groups.google.com/forum/#!topic/consul-tool/DgwWdpntaAY</a>):</p>
<ul>
<li>Using one key per root and storing all the root tree as JSON object e.g.<code>/foo {json}</code>;</li>
<li>Using key per 1-level children - and storing all grandchildren as JSON e.g. <code>/foo/bar {json}</code></li>
<li>or storing each grand children per key e.g <code>/foo/bar/zar {json}</code></li>
</ul>
<p>the appropriate structure in Consul KV would be:
<code>/first_level/second_level/third_level/theKey</code> and the value for that last key would be <code>theValue</code> - solution inspired by <a href="https://github.com/Cimpress-MCP/git2consul" target="_blank">https://github.com/Cimpress-MCP/git2consul</a></p>
<p>Another option would be to encode a JSON object to Base64 - see <a href="https://developer.mozilla.org/en/docs/Web/API/WindowBase64/Base64_encoding_and_decoding" target="_blank">Base64 encoding and decoding</a> or <a href="http://stackoverflow.com/questions/34341836/how-to-convert-a-json-object-to-a-base64-string" target="_blank">http://stackoverflow.com/questions/34341836/how-to-convert-a-json-object-to-a-base64-string</a></p>
<h3 id="consul-and-docker-swarm">Consul and Docker SWARM</h3>
<p>As illustrated in <a href="Consul-for-Service-Discovery-on-Docker-Swarm.html">Consul for Service Discovery on Docker Swarm</a> we are making use of <a href="http://proxy.dockerflow.com" target="_blank">Docker Flow Proxy</a> and <a href="http://swarmlistener.dockerflow.com/" target="_blank">Docker Swarm Listener</a> in order to implement a Server-Side Service Discovery pattern. However there are a few naming conventions that should be taken into consideration.</p>
<h4 id="using-consul-catalog-for-service-discovery">Using Consul Catalog for Service Discovery</h4>
<p>In this solution there are two main components the Service Discovery (where service are registered in the Consul catalogue of service for being monitored, and possible for healthcheck) and the Service Registry (where the services are registered using the Docker Swarm listener and used by Docker Flow proxy in the Consul K/V store).</p>
<ul>
<li>Docker SWARM<ul>
<li>serviceName = name of the docker container in the network</li>
</ul>
</li>
<li>Docker Flow Proxy<ul>
<li>serviceName = name of the container in the network</li>
<li>servicePath = /[service name from consul]/endpoint</li>
</ul>
</li>
<li>Consul<ul>
<li>catalog<ul>
<li>serviceName = application type of service</li>
<li>serviceID = service name from SWARM</li>
<li>tag = v1</li>
</ul>
</li>
<li>kv<ul>
<li>serviceName/description = &quot;Description of the the service&quot;</li>
<li>serviceName/dataset = &apos;/ds&apos;</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>Docker SWARM<ul>
<li>serviceName = ES1</li>
<li>serviceName = ES5</li>
</ul>
</li>
<li>Docker Flow Proxy<ul>
<li>elasticsearch 1.3<ul>
<li>serviceName = ES1</li>
<li>servicePath = /ES1/jsonRestAPI/</li>
<li>reqPathSearch = /ES1/jsonRestAPI/</li>
<li>reqPathReplace = /</li>
</ul>
</li>
<li>elasticsearch 5.x<ul>
<li>serviceName = ES5</li>
<li>servicePath = /ES5/jsonRestAPI/</li>
<li>reqPathSearch = /ES5/jsonRestAPI/</li>
<li>reqPathReplace = /</li>
</ul>
</li>
</ul>
</li>
<li>Consul<ul>
<li>catalog<pre><code class="lang-json">[
  {
      <span class="hljs-string">&quot;serviceName&quot;</span>: <span class="hljs-string">&quot;jsonRestAPI&quot;</span>,
      <span class="hljs-string">&quot;serviceID&quot;</span>: <span class="hljs-string">&quot;ES1&quot;</span>,
      <span class="hljs-string">&quot;tags&quot;</span>: [<span class="hljs-string">&quot;v1&quot;</span>]
  },
  {
      <span class="hljs-string">&quot;serviceName&quot;</span>: <span class="hljs-string">&quot;jsonRestAPI&quot;</span>,
      <span class="hljs-string">&quot;serviceID&quot;</span>: <span class="hljs-string">&quot;ES5&quot;</span>,
      <span class="hljs-string">&quot;tags&quot;</span>: [<span class="hljs-string">&quot;v1&quot;</span>]
  }
]
</code></pre>
</li>
<li>kv
/ES1/description = &quot;REST API that uses old version of the ES&quot;
/ES5/description = &quot;REST API implemented with the current version of the ES&quot;</li>
</ul>
</li>
<li>Querying for services of type &quot;jsonRestAPI&quot; and version &quot;v1&quot;:
<code>http://proxy/consul/catalog/service/jsonRestAPI?tag=v1</code><ul>
<li>Returns: serviceIDs</li>
</ul>
</li>
<li>Access the service (e.g. indexing): <code>proxy/[serviceID]/[serviceName]/[endpoint]</code><pre><code>  PUT http://proxy/ES1/jsonRestAPI/[indexName]/[document type]
</code></pre></li>
</ul>
<h4 id="using-consul-kv-for-service-discovery">Using Consul K/V for Service Discovery</h4>
<p>In this solution we would be using the services are registered using the Docker Swarm listener and used by Docker Flow proxy in the Consul K/V store in order to discover new services, and client side processing.</p>
<p>In order to add new values to the Consul K/V store, we will have to pass some environment variables to the container and at the same time follow the structure of the docker flow proxy for registering service parameters.</p>
<ul>
<li>Docker SWARM<ul>
<li>serviceName = name of the docker container in the network</li>
</ul>
</li>
<li>Docker Flow Proxy<ul>
<li>serviceName = name of the container in the network</li>
<li>servicePath = /[service name from consul]/endpoint</li>
</ul>
</li>
<li>Consul<ul>
<li>kv<ul>
<li>/docker-flow/serviceName/description = &quot;Description of the the service&quot;</li>
<li>/docker-flow/serviceName/dataset = &apos;/ds&apos;</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>Docker SWARM<ul>
<li>serviceName = ES1</li>
<li>serviceName = ES5</li>
</ul>
</li>
<li>Docker Flow Proxy<ul>
<li>elasticsearch 1.3<ul>
<li>serviceName = ES1</li>
<li>servicePath = /ES1/jsonRestAPI/</li>
<li>reqPathSearch = /ES1/jsonRestAPI/</li>
<li>reqPathReplace = /</li>
</ul>
</li>
<li>elasticsearch 5.x<ul>
<li>serviceName = ES5</li>
<li>servicePath = /ES5/jsonRestAPI/</li>
<li>reqPathSearch = /ES5/jsonRestAPI/</li>
<li>reqPathReplace = /</li>
</ul>
</li>
</ul>
</li>
<li>Consul<ul>
<li>kv
/docker-flow/jsonRestAPI_ES1_v1/description = &quot;REST API that uses old version of the ES&quot;
/docker-flow/jsonRestAPI_ES5_v1/description = &quot;REST API implemented with the current version of the ES&quot;</li>
</ul>
</li>
<li>Querying for services of type &quot;jsonRestAPI&quot; and version &quot;v1&quot;:<ul>
<li><code>http://proxy/consul/v1/kv/docker-flow/service/jsonRestAPI_ES1_v1?keys</code></li>
<li><code>http://proxy/consul/v1/kv/docker-flow/service/jsonRestAPI_ES1_v1?recurse</code></li>
</ul>
</li>
<li>Querying for services of type &quot;jsonRestAPI&quot;:<ul>
<li><code>http://proxy/consul/v1/kv/docker-flow/service/jsonRestAPI_?keys</code></li>
<li><code>http://proxy/consul/v1/kv/docker-flow/service/jsonRestAPI_?recurse</code></li>
</ul>
</li>
<li>Querying for services of type &quot;jsonRestAPI&quot; ES1 versions:<ul>
<li><code>http://proxy/consul/v1/kv/docker-flow/service/jsonRestAPI_ES1?keys</code></li>
</ul>
</li>
<li>Querying for parameter keys of type &quot;jsonRestAPI&quot; ES1 version &quot;v1&quot;:<ul>
<li><code>http://proxy/consul/v1/kv/docker-flow/service/jsonRestAPI_ES1_v1?keys</code></li>
</ul>
</li>
<li>Access the service (e.g. indexing): <code>proxy/[serviceID]/[serviceName]/[endpoint]</code><pre><code>  PUT http://proxy/ES1/jsonRestAPI/[indexName]/[document type]
</code></pre></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/42054051/service-discovery-in-docker-without-using-consul" target="_blank">https://stackoverflow.com/questions/42054051/service-discovery-in-docker-without-using-consul</a></li>
<li><a href="https://stackoverflow.com/questions/39132292/how-to-deploy-consul-using-docker-1-12-swarm-mode" target="_blank">https://stackoverflow.com/questions/39132292/how-to-deploy-consul-using-docker-1-12-swarm-mode</a></li>
<li>Installing Hashicorp&#x2019;s Consul and using Python 3 to communicate with it <a href="http://www.giantflyingsaucer.com/blog/?p=5579" target="_blank">http://www.giantflyingsaucer.com/blog/?p=5579</a></li>
<li><a href="http://proxy.dockerflow.com/" target="_blank">http://proxy.dockerflow.com/</a></li>
<li><a href="https://labs.magnet.me/nerds/2015/10/26/consultant-configuration-management-with-consul.html" target="_blank">https://labs.magnet.me/nerds/2015/10/26/consultant-configuration-management-with-consul.html</a> - for using the K/V Store</li>
<li><a href="https://www.spirulasystems.com/blog/2015/06/25/building-an-automatic-environment-using-consul-and-docker-part-1/" target="_blank">https://www.spirulasystems.com/blog/2015/06/25/building-an-automatic-environment-using-consul-and-docker-part-1/</a></li>
<li><a href="https://www.spirulasystems.com/blog/2015/07/02/automatic-environment-using-consul-and-docker-swarm-part-2/" target="_blank">https://www.spirulasystems.com/blog/2015/07/02/automatic-environment-using-consul-and-docker-swarm-part-2/</a></li>
<li><a href="https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/" target="_blank">https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/</a></li>
<li><a href="http://www.dblooman.com/consul/2016/09/11/Consul-and-Service-discovery,-how-it-can-help/" target="_blank">http://www.dblooman.com/consul/2016/09/11/Consul-and-Service-discovery,-how-it-can-help/</a></li>
<li><a href="https://technologyconversations.com/2016/03/21/docker-flow-proxy-on-demand-haproxy-service-discovery-and-reconfiguration/" target="_blank">https://technologyconversations.com/2016/03/21/docker-flow-proxy-on-demand-haproxy-service-discovery-and-reconfiguration/</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ElasticSearch-5.html" class="navigation navigation-prev " aria-label="Previous page: ElasticSearch 5.x">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Consul-for-Service-Discovery-on-Docker-Swarm.html" class="navigation navigation-next " aria-label="Next page: Consul for Service Discovery on Docker Swarm">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Service Discovery Implementation","level":"1.8","depth":1,"next":{"title":"Consul for Service Discovery on Docker Swarm","level":"1.8.1","depth":2,"path":"Consul-for-Service-Discovery-on-Docker-Swarm.md","ref":"Consul-for-Service-Discovery-on-Docker-Swarm.md","articles":[]},"previous":{"title":"ElasticSearch 5.x","level":"1.7.2","depth":2,"path":"ElasticSearch-5.md","ref":"ElasticSearch-5.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["highlight","fontsettings","search","git-author","gitversion"],"pluginsConfig":{"gitversion":{},"git-author":{"position":"top","modifyTpl":"Current page last modified at: {timeStamp}","createTpl":false,"timeStampFormat":"DD-MMM-YYYY HH:mm:ss"},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"family":"sans","size":2,"theme":"white"},"fontSettings":{"size":1},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"ServiceDiscovery-Implementation.md","mtime":"2017-05-29T14:00:13.498Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-07-10T14:01:04.490Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    

    </body>
</html>

