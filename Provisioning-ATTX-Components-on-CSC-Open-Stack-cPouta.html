
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Provisioning ATTX Components on CSC Open Stack (cPouta) Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Deploying-ATTX-Components-on-Docker-Swarm.html" />
    
    
    <link rel="prev" href="Building-Docker-application-stacks-in-Swarm-Mode.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">ATTX Project</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Architecture.html">
            
                <a href="Architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Platform-Deployment.html">
            
                <a href="Platform-Deployment.html">
            
                    
                    Platform Deployment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="CSC-cPouta-Cloud-Services-Report.html">
            
                <a href="CSC-cPouta-Cloud-Services-Report.html">
            
                    
                    CSC cPouta Cloud Services Report
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Building-Docker-application-stacks-in-Swarm-Mode.html">
            
                <a href="Building-Docker-application-stacks-in-Swarm-Mode.html">
            
                    
                    Building Swarm Mode on a PC or Mac
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html">
            
                <a href="Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.html">
            
                    
                    Provisioning ATTX Components on CSC Open Stack (cPouta)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="Deploying-ATTX-Components-on-Docker-Swarm.html">
            
                <a href="Deploying-ATTX-Components-on-Docker-Swarm.html">
            
                    
                    Deploying ATTX Components on Docker Swarm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.html">
            
                <a href="Running-the-ATTX-containerised-application-stack-in-your-own-PC-or-Mac.html">
            
                    
                    Running the ATTX Stack on a PC or Mac
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="Using-Consul-for-Service-Discovery-on-Docker-Swarm.html">
            
                <a href="Using-Consul-for-Service-Discovery-on-Docker-Swarm.html">
            
                    
                    Using Consul for Service Discovery on Docker Swarm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Workflow-Component.html">
            
                <a href="Workflow-Component.html">
            
                    
                    Workflow Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="ETL-Artifacts.html">
            
                <a href="ETL-Artifacts.html">
            
                    
                    ETL Artifacts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="Unified-Views-plugins.html">
            
                <a href="Unified-Views-plugins.html">
            
                    
                    UnifiedViews plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="WF-API.html">
            
                <a href="WF-API.html">
            
                    
                    Workflow API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Graph-Component.html">
            
                <a href="Graph-Component.html">
            
                    
                    Graph Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="Graph-Manager-API.html">
            
                <a href="Graph-Manager-API.html">
            
                    
                    Graph Manager API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="Graph-Store.html">
            
                <a href="Graph-Store.html">
            
                    
                    Graph Store
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="Data-Model.html">
            
                <a href="Data-Model.html">
            
                    
                    Ontology/Data model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="Namespaces.html">
            
                <a href="Namespaces.html">
            
                    
                    Graph Namespaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="Linking-Strategies.html">
            
                <a href="Linking-Strategies.html">
            
                    
                    Linking Strategies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Distribution-Component.html">
            
                <a href="Distribution-Component.html">
            
                    
                    Distribution Component
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="ElasticSearch-with-Siren.html">
            
                <a href="ElasticSearch-with-Siren.html">
            
                    
                    ElasticSearch with Siren
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="ElasticSearch-5.html">
            
                <a href="ElasticSearch-5.html">
            
                    
                    ElasticSearch 5.x
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="Applications-and-Use-Cases.html">
            
                <a href="Applications-and-Use-Cases.html">
            
                    
                    Applications and Use Cases
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="UC1---Infrastructures-and-publications.html">
            
                <a href="UC1---Infrastructures-and-publications.html">
            
                    
                    UC1 - infras and pubs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="Use-case-Metax.html">
            
                <a href="Use-case-Metax.html">
            
                    
                    UC - Metax
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Project Guidelines</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="Feature-roadmap.html">
            
                <a href="Feature-roadmap.html">
            
                    
                    Feature Roadmap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Release-Plan.html">
            
                <a href="Release-Plan.html">
            
                    
                    Release Plan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="Project-Development-Environment.html">
            
                <a href="Project-Development-Environment.html">
            
                    
                    Project Development Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="CI-CD-Enviroment.html">
            
                <a href="CI-CD-Enviroment.html">
            
                    
                    CI/CD Enviroment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="Jenkins.html">
            
                <a href="Jenkins.html">
            
                    
                    Jenkins CI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="Build-Multiple-Environments.html">
            
                <a href="Build-Multiple-Environments.html">
            
                    
                    Build Environment Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.3" data-path="Containerized-testing.html">
            
                <a href="Containerized-testing.html">
            
                    
                    Containerized testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
                <span>
            
                    
                    Reports
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="Building-with-Gradle.html">
            
                <a href="Building-with-Gradle.html">
            
                    
                    Building with (Py)Gradle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.2" data-path="Messaging-Brokers.html">
            
                <a href="Messaging-Brokers.html">
            
                    
                    Messaging Brokers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.3" data-path="Service-Discovery.html">
            
                <a href="Service-Discovery.html">
            
                    
                    Service Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.4" data-path="Workflow-Management-Tools.html">
            
                <a href="Workflow-Management-Tools.html">
            
                    
                    Workflow Management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="Contributions.html">
            
                <a href="Contributions.html">
            
                    
                    Contributions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.6.1" data-path="ELAG-2017.html">
            
                <a href="ELAG-2017.html">
            
                    
                    ELAG2017
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://www.helsinki.fi/en/projects/attx-2016">
            
                    
                    ATTX website
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Provisioning ATTX Components on CSC Open Stack (cPouta)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="provisioning-attx-components-on-csc-open-stack-cpouta">Provisioning ATTX Components on CSC Open Stack (cPouta)</h1>
<p>This guide exemplifies how to provision 5 VMs in cPouta (CSC Open Stack) with Ansible, for forming a Docker Swarm and running the ATTX stack.</p>
<!-- TOC START min:1 max:3 link:true update:true -->
<ul>
<li><a href="#1-preparing-ansibles-control-node">1. Preparing Ansible&apos;s control node</a></li>
<li><a href="#2-upload-and-edit-ansibles-configuration-files">2. Upload and edit Ansible&apos;s configuration files</a></li>
<li><a href="#3-provisioning-the-instances">3. Provisioning the instances</a></li>
<li><a href="#4-possible-problems-and-solutions">4. Possible problems and solutions</a></li>
</ul>
<!-- TOC END -->
<p>Requirements :</p>
<ol>
<li><p>Minimum of 3 instances created on cPouta (Ubuntu-16.04 recommended) (cf. <a href="https://research.csc.fi/pouta-flavours" target="_blank">https://research.csc.fi/pouta-flavours</a>).</p>
</li>
<li><p>A Key Pair certificate must be created and associated with all instances, to allow access as &quot;cloud-user&quot; (cPouta default). SSH access security group must be created and associated with all instances, so that SSH communication between them is possible. Public floating IP address must be associated with one instance, for external connections (SSH, SFTP) (cf. <a href="https://research.csc.fi/pouta-getting-started" target="_blank">https://research.csc.fi/pouta-getting-started</a>).</p>
</li>
<li><p>The Key Pair certificate must be imported to the host computer of ATTX developer/user, in order to allow SSH and SFTP authentication to the instance associated with the the public floating IP address (cf. <a href="https://research.csc.fi/pouta-connecting-a-virtual-machine" target="_blank">https://research.csc.fi/pouta-connecting-a-virtual-machine</a>).
On linux commands to add certificates could be added by runing:</p>
<ul>
<li>Start ssh agent (if not started) <code>eval &quot;$(ssh-agent -s)&quot;</code></li>
<li>Add private key from a specific location: <code>ssh-add ~/user/cpouta.psk</code></li>
</ul>
</li>
</ol>
<h2 id="1-preparing-ansibles-control-node">1. Preparing Ansible&apos;s control node</h2>
<p>In order for your instance with the public IP address (e.g. &quot;attx-instance-1&quot;) to be set up as Ansible&apos;s control node, you&apos;ll need to install PIP and Ansible&apos;s prerequisites:</p>
<pre><code>$ sudo apt-get update
$ sudo apt-get upgrade
$ sudo apt-get install python-dev
$ sudo apt-get install python-pip
</code></pre><p>Install Ansible:</p>
<pre><code>$ sudo apt-get install ansible
</code></pre><h2 id="2-upload-and-edit-ansibles-configuration-files">2. Upload and edit Ansible&apos;s configuration files</h2>
<p>Via SFTP or SCP, transfer the contents of  <github_repo_link> to your instance in cPouta with the floating public IP address (e.g. &quot;attx-stack-1&quot;), namely to the instance that you have set up as the Ansible control node for this exercise.</github_repo_link></p>
<p>The list of the files is:</p>
<ul>
<li><p><code>inventory</code> (hostname and IP address information used by Ansible for setting up the instances with Docker and Docker-Compose, <strong>must be edited</strong> as per your instances hostnames and IP addresses)</p>
</li>
<li><p><code>cpouta.yml</code> (hostname and IP address information used by Ansible for building up /etc/hosts in all instances, <strong>must be edited</strong> as per your instances hostnames and IP addresses)</p>
</li>
<li><p><code>provisioning.yml</code> and <code>ansible.cfg</code> (Ansible&apos;s provisioning and configuration files, <strong>don&apos;t edit</strong>)</p>
</li>
<li><p><code>ssh-config</code> and <code>private-key</code> (SSH configuration and private key for Ansible, <strong>don&apos;t edit</strong>)</p>
</li>
</ul>
<p>The recommended path for the Ansible files is <code>/home/cloud-user/provision-swarm</code> (<strong>must be created</strong>).</p>
<h2 id="3-provisioning-the-instances">3. Provisioning the instances</h2>
<p>From Ansible&apos;s control node, run as cloud-user:</p>
<pre><code>$ ansible-playbook provisioning.yml
</code></pre><p>You can display extra verbose information for troubleshooting with the <code>-vvvv</code> option, e.g. &quot;<code>ansible-playbook -i hosts provisioning.yml -vvvv</code>&quot;</p>
<h2 id="4-possible-problems-and-solutions">4. Possible problems and solutions</h2>
<ul>
<li><p>If you get strange Ansible errors about dependencies, try to check your pip
version with <code>pip --version</code>. The current version is 9.0.1. If your pip is
older than this, upgrade it with <code>sudo pip install --upgrade pip</code>, restart
your terminal session and install the Ansible prerequisites again.</p>
</li>
<li><p>If Ansible fails to pip-install docker-compose on a node complaining about a pip module&apos;s version, try to to    upgrade that module with <code>sudo pip install -upgrade &lt;module&gt;</code> (e.g. <code>sudo pip install --upgrade six</code>) , and run the Ansible provisioning again. You can find in Github repo <link_here> a list of pip modules known to work (&quot;pip.requirements.txt&quot;), which can be installed with <code>sudo pip install -r pip.requirements.txt</code>.</link_here></p>
</li>
<li><p>If you get a ssh error saying <code>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED</code>
it means that you already had in the past some other host using one of the
IP addresses we use here as example. To solve this, remove the old entry in your SSH
<code>known_hosts</code> file with:</p>
<pre><code>$ ssh-keygen -f &quot;~/.ssh/known_hosts&quot; -R &lt;INSTANCE_IP_ADDRESS&gt; -R &lt;INSTANCE_IP_ADDRESS&gt; -R &lt;INSTANCE_IP_ADDRESS&gt; -R &lt;INSTANCE_IP_ADDRESS&gt; -R &lt;INSTANCE_IP_ADDRESS&gt;
</code></pre></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Building-Docker-application-stacks-in-Swarm-Mode.html" class="navigation navigation-prev " aria-label="Previous page: Building Swarm Mode on a PC or Mac">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Deploying-ATTX-Components-on-Docker-Swarm.html" class="navigation navigation-next " aria-label="Next page: Deploying ATTX Components on Docker Swarm">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Provisioning ATTX Components on CSC Open Stack (cPouta)","level":"1.3.3","depth":2,"next":{"title":"Deploying ATTX Components on Docker Swarm","level":"1.3.4","depth":2,"path":"Deploying-ATTX-Components-on-Docker-Swarm.md","ref":"Deploying-ATTX-Components-on-Docker-Swarm.md","articles":[]},"previous":{"title":"Building Swarm Mode on a PC or Mac","level":"1.3.2","depth":2,"path":"Building-Docker-application-stacks-in-Swarm-Mode.md","ref":"Building-Docker-application-stacks-in-Swarm-Mode.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["highlight"],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Provisioning-ATTX-Components-on-CSC-Open-Stack-cPouta.md","mtime":"2017-05-04T09:15:00.999Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-05-04T10:34:16.588Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

